# AIGenius Ticketing - Docker Compose
# AI-powered Customer Support Ticketing System

version: "3.8"

services:
  # Main Ticket Service
  aigenius-ticketing:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: aigenius-ticketing
    ports:
      - "8000:8000"
    environment:
      # Application
      - APP_NAME=aigenius-ticketing
      - APP_VERSION=1.0.0
      - ENVIRONMENT=development
      - DEBUG=true

      # Server
      - HOST=0.0.0.0
      - PORT=8000

      # Database (update with your PostgreSQL connection)
      - DATABASE_URL=${DATABASE_URL}
      - DB_POOL_SIZE=5
      - DB_MAX_OVERFLOW=10

      # SLA Configuration
      - SLA_CONFIG_PATH=/app/sla_config.yaml
      - SLA_EVALUATION_INTERVAL=60

      # Slack Webhook (for SLA breach alerts)
      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL}
      - SLACK_CHANNEL=${SLACK_CHANNEL:-#all-customer-tickets}
      - SLACK_TIMEOUT_SECONDS=5

      # LLM (GLM 4.7)
      - ZAI_API_KEY=${ZAI_API_KEY}

      # Grafana OTLP Metrics
      - GRAFANA_HOST=${GRAFANA_HOST}
      - GRAFANA_API_KEY=${GRAFANA_API_KEY}
      - GRAFANA_INSTANCE_ID=1478964

      # Milvus Vector Store (Zhipu Cloud)
      - MILVUS_HOST=https://inference-api.zhipuai.cn/v1/embeddings
      - MILVUS_PORT=443
      - MILVUS_COLLECTION_NAME=tickets_docs
      - EMBEDDING_DIMENSION=1024
      - TOP_K_RESULTS=5

      # LLM Settings
      - LLM_MODEL=glm-4.7
      - EMBEDDING_MODEL=embedding-2

      # CORS
      - CORS_ORIGINS=http://localhost:3000,http://localhost:8080
    volumes:
      - ./sla_config.yaml:/app/sla_config.yaml:ro
      - logs:/app/logs
    restart: unless-stopped
    networks:
      - aigenius-network

networks:
  aigenius-network:
    driver: bridge

volumes:
  logs:
    driver: local
